<html>
{% load leaflet_tags %}

<head>
   {% leaflet_js %}
   {% leaflet_css %}

<style>

    .leaflet-container {  /* all maps */
        width:  1200px;
        height: 800px;
    }

</style>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

</head>


<body>


{% leaflet_map "yourmap" %}

<p>
Min SST: <input class=sst_limit type="number" name="minSST" id="minSST" min="-2" max="35" value=-2>
Max SST: <input class=sst_limit type="number" name="maxSST" id="maxSST" min="-2" max="35" value=35>
</p>


{% for quicklook in quicklooks %}
        <label for="show_overlay">Show {{ quicklook.name }}</label>
        <input type="checkbox" id={{ forloop.counter }} {% if forloop.counter == 1 %} checked=true {% endif %} >
        <input class=opacity_number type="number" name="quantity" id={{ forloop.counter }} min="0" max="100" value=100>
        <br>
{% endfor %}


{% block quicklooks %}
{% endblock quicklooks %}

<script type="text/javascript">
    var map;
    var imageOverlays = [];

    window.addEventListener("map:init", function (e) {
        window.map = e.detail.map;

        {% for ql in quicklooks %}
            var imageUrl = "{{ STATIC_URL }}sar_web/{{ ql.sar_web.all.0.mapper }}/{{ ql.name }}";
            var imageBounds = {{ ql.sar_web.all.0.get_bounds }};
            imageOverlays[{{ forloop.counter }}] = L.imageOverlay(imageUrl, imageBounds);
        {% endfor %}

        add_sst();

        imageOverlays[1].addTo(window.map);
    }, false);

function toggle_overlay(cb) {
    if (cb.checked == true) imageOverlays[cb.id].addTo(window.map);
    else window.map.removeLayer(imageOverlays[cb.id]);
};

function set_sst_url(){
    urlMinSST = parseFloat(window.minSST.value) + 273;
    urlMaxSST = parseFloat(window.maxSST.value) + 273;
    sstURL = "http://data.nodc.noaa.gov/thredds/wms/ghrsst/L4/GLOB/JPL_OUROCEAN/G1SST/2014/259/20140916-JPL_OUROCEAN-L4UHfnd-GLOB-v01-fv01_0-G1SST.nc.bz2?service=WMS&COLORSCALERANGE=" + urlMinSST + ',' + urlMaxSST;
};

function add_sst() {
    set_sst_url();
    sstWMS = L.tileLayer.wms(sstURL, {
        layers: 'analysed_sst',
        format: 'image/png',
        transparent: true,
        attribution: "JPL OUROCEAN SST",
    });

    sstWMS.addTo(window.map);
}

function update_sst() {
    set_sst_url();
    sstWMS.setUrl(sstURL);
};

$(':checkbox').click(function() {
    toggle_overlay(this);
});

$(".opacity_number").bind('input', function() {
    imageOverlays[this.id].setOpacity(this.value / 100);
});

$(".sst_limit").bind('input', function() { update_sst(); });


$(':checkbox').click(function() {
    toggle_overlay(this);
});

</script>


</body>
</html>
