---
- name: Local VM | Mount network folders
  become: yes
  mount:
    name: "{{ item.mount_name }}/{{ item.folder }}"
    src: "{{ item.mount_src }}/{{ item.folder }}"
    fstype: cifs
    opts: "uid={{ uid }},gid={{ gid }},username={{ username }},password={{ password }},domain={{ domain }}"
    state: mounted
  with_items:
    - "{{ mount_folders }}"
  ignore_errors: yes

- name: Local VM | Make lib folder in package root
  file:
    path: /vagrant/lib
    state: directory
    mode: 0755

- name: Local VM | Ensure .ipython folder exists
  file:
      path: /home/vagrant/.ipython
      state: directory

- name: Local VM | Ensure .ipython/profile_default folder exists
  file:
      path: /home/vagrant/.ipython/profile_default 
      state: directory

- name: Local VM | Check if ipython history file exists in default location
  stat: path=/home/vagrant/.ipython/profile_default/history.sqlite
  register: ipython_history

- name: Local VM | Create ipython history file if it does not exist
  file:
      path: /home/vagrant/.ipython/profile_default/history.sqlite
      state: touch
      mode: 0755
  when: not ipython_history.stat.exists

# update variable..
- name: Local VM | Check if ipython history file exists in default location
  stat: path=/home/vagrant/.ipython/profile_default/history.sqlite
  register: ipython_history

- name: Local VM | Move ipython history file if it exists in default location
  command: mv /home/vagrant/.ipython/profile_default/history.sqlite /vagrant/lib/ipython_history.sqlite
  when: ipython_history.stat.exists and not ipython_history.stat.islnk

- name: Local VM | Create link to ipython history file
  file:
      src: /vagrant/lib/ipython_history.sqlite
      dest: /home/vagrant/.ipython/profile_default/history.sqlite
      state: link

- name: Local VM | Check if bash history file exists in default location
  stat: path=/home/vagrant/.bash_history
  register: bash_history

- name: Local VM | Create bash history file if it does not exist
  file:
      path: /home/vagrant/.bash_history
      state: touch
      mode: 0755
  when: not bash_history.stat.exists

- name: Local VM | Move bash history file if it exists in default location
  command: mv /home/vagrant/.bash_history /vagrant/lib/dot_bash_history
  when: bash_history.stat.exists and not bash_history.stat.islnk

- name: Local VM | Create link to shared bash history file
  file:
      src: /vagrant/lib/dot_bash_history
      dest: /home/vagrant/.bash_history
      state: link
